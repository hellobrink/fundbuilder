<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Innovation Fund Builder - Professional method cards for building effective funds</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="part2-page">
    <div class="toolbar">
        <div class="toolbar-left">
            <button class="toolbar-btn" id="p2-btn-back" onclick="p2Back()" title="Back">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                Back
            </button>
        </div>
        <div class="toolbar-center">
            <span class="toolbar-title">Building your open innovation fund</span>
            <span class="part-badge">Part 2</span>
        </div>
        <div class="toolbar-right">
            <button class="toolbar-btn" onclick="p2Reset()" title="Refresh">
                Refresh
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
        </div>
    </div>

    <!-- Screen 0: How This Works -->
    <div id="p2-screen-howto">
        <div class="canvas-explanation">
            <h2>How This Works</h2>
            <p>This tool works like a "choose your own adventure" story, but for grant fund design. Use the method cards in this section to spark discussion between you and your colleagues (and don't forget to enjoy the process!).</p>
            <div class="canvas-flow">
                <div class="canvas-step">
                    <span class="step-icon">1</span>
                    <h3>Pick a stage</h3>
                    <p>from the 8 fund building phases below</p>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="canvas-step">
                    <span class="step-icon">2</span>
                    <h3>Explore method cards</h3>
                    <p>click to flip and read detailed guidance</p>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="canvas-step">
                    <span class="step-icon">3</span>
                    <h3>Bank the methods</h3>
                    <p>you want to use in your fund strategy</p>
                </div>
            </div>
            <p class="canvas-outcome">üí° You can jump between stages anytime and build your strategy piece by piece. Your banked cards will accumulate in the journey map below!</p>
        </div>
        <div class="screen-nav">
            <button class="nav-btn primary" onclick="goToP2Screen(1)">Let's go</button>
        </div>
    </div>

    <!-- Screen 1: Main Tool (three sub-screens) -->
    <div id="p2-screen-main" style="display: none;">

        <!-- Sub-screen A: Stage Selector + Inline Card Expansion -->
        <div id="p2-sub-stages">
            <div class="container">
                <div id="stage-selector" class="stage-selector">
                    <h2>Explore method cards</h2>
                    <div class="stage-grid">
                        <!-- Row 1 -->
                        <div class="stage-circle stage-col-1" onclick="selectStage('A')" data-stage="A">
                            <h3>Design & Thesis Development</h3>
                            <p>Define your fund's core purpose</p>
                        </div>
                        <div class="stage-circle stage-col-2" onclick="selectStage('D')" data-stage="D">
                            <h3>Financial Support</h3>
                            <p>Types of financial support available to offer</p>
                        </div>
                        <div class="stage-circle stage-col-3" onclick="selectStage('C')" data-stage="C">
                            <h3>Awareness & Engagement</h3>
                            <p>Build visibility and attract applicants</p>
                        </div>
                        <div class="stage-circle stage-col-4" onclick="selectStage('G')" data-stage="G">
                            <h3>Selection & Rejection</h3>
                            <p>Build fair selection processes</p>
                        </div>
                        <!-- Row 2 -->
                        <div class="stage-circle stage-col-1" onclick="selectStage('B')" data-stage="B">
                            <h3>Strategy & Target Portfolio</h3>
                            <p>Shape your funding approach</p>
                        </div>
                        <div class="stage-circle stage-col-2" onclick="selectStage('E')" data-stage="E">
                            <h3>Non-Financial Support</h3>
                            <p>Methods for designing comprehensive grantee support systems</p>
                        </div>
                        <div class="stage-circle stage-col-3" onclick="selectStage('F')" data-stage="F">
                            <h3>Engagement & Application</h3>
                            <p>Create accessible processes</p>
                        </div>
                        <div class="stage-circle stage-col-4" onclick="selectStage('H')" data-stage="H">
                            <h3>Portfolio Management</h3>
                            <p>Manage and optimize your portfolio</p>
                        </div>
                    </div>
                </div>

                <!-- Cards expand inline below the stage grid -->
                <div id="cards-section" class="cards-section">
                    <div class="cards-theme-box">
                        <p class="section-description" id="cards-description">Click any card to flip it and read the detailed guidance</p>
                        <div id="cards-grid" class="cards-grid">
                            <!-- Cards will be populated here -->
                        </div>
                    </div>
                    <div class="cards-actions-nav">
                        <button class="nav-btn" onclick="flipAllCards()">Flip All Cards</button>
                        <button class="nav-btn" onclick="getRandomCard()">Random Card</button>
                        <button class="nav-btn primary" onclick="showP2SubScreen('review')">Review Your Banked Cards</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sub-screen C: Review (Journey Map + Export) -->
        <div id="p2-sub-review" style="display: none;">
            <div class="container">
                <div class="journey-map">
                    <h2>Your Fund Building Journey</h2>
                    <p class="section-description">Bank method cards to build your comprehensive funding strategy</p>

                    <div class="journey-bank-box">
                        <div class="journey-stages">
                            <div class="journey-stage" id="journey-A">
                                <h4>Design & Thesis Development</h4>
                            </div>
                            <div class="journey-stage" id="journey-B">
                                <h4>Strategy & Target Portfolio</h4>
                            </div>
                            <div class="journey-stage" id="journey-C">
                                <h4>Awareness & Engagement</h4>
                            </div>
                            <div class="journey-stage" id="journey-D">
                                <h4>Financial Support</h4>
                            </div>
                            <div class="journey-stage" id="journey-E">
                                <h4>Non-Financial Support</h4>
                            </div>
                            <div class="journey-stage" id="journey-F">
                                <h4>Engagement & Application</h4>
                            </div>
                            <div class="journey-stage" id="journey-G">
                                <h4>Selection & Rejection</h4>
                            </div>
                            <div class="journey-stage" id="journey-H">
                                <h4>Portfolio Management</h4>
                            </div>
                        </div>

                        <div class="banked-cards">
                            <div class="card-stack" id="stack-A"></div>
                            <div class="card-stack" id="stack-B"></div>
                            <div class="card-stack" id="stack-C"></div>
                            <div class="card-stack" id="stack-D"></div>
                            <div class="card-stack" id="stack-E"></div>
                            <div class="card-stack" id="stack-F"></div>
                            <div class="card-stack" id="stack-G"></div>
                            <div class="card-stack" id="stack-H"></div>
                        </div>
                    </div>

                    <div class="export-section">
                        <button class="export-btn secondary" onclick="showP2SubScreen('stages')">‚Üê Back to Your Cards</button>
                        <button class="export-btn secondary" onclick="exportAdvicePDF()">Export as PDF</button>
                        <button class="export-btn secondary" onclick="exportAdvice()">Export as Text</button>
                        <button class="export-btn coral" onclick="showP2SubScreen('next')">Finish</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sub-screen D: Next Steps -->
        <div id="p2-sub-next" style="display: none;">
            <div class="container">
                <div class="next-steps-section">
                    <h2>What Comes Next</h2>
                    <p class="section-description">You've built your fund strategy ‚Äî here's how to bring it to life</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
                </div>
            </div>
        </div>

    </div><!-- /p2-screen-main -->

    <!-- Custom modal (replaces native alert) -->
    <div id="site-modal" class="site-modal-overlay" onclick="if(event.target===this)closeSiteModal()">
        <div class="site-modal">
            <h3 id="site-modal-title"></h3>
            <p id="site-modal-body"></p>
            <div class="site-modal-footer">
                <button class="nav-btn" onclick="closeSiteModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="./app.js"></script>
    <script>
        let p2CurrentScreen = 0;
        let p2CurrentSubScreen = 'stages';

        function goToP2Screen(screen) {
            p2CurrentScreen = screen;
            document.getElementById('p2-screen-howto').style.display = screen === 0 ? '' : 'none';
            document.getElementById('p2-screen-main').style.display = screen === 1 ? '' : 'none';
            window.scrollTo(0, 0);
        }

        function showP2SubScreen(name) {
            p2CurrentSubScreen = name;
            // 'stages' houses the inline cards expansion ‚Äî both map to the same div
            const showStages = (name === 'stages' || name === 'cards');
            document.getElementById('p2-sub-stages').style.display = showStages ? '' : 'none';
            document.getElementById('p2-sub-review').style.display = name === 'review' ? '' : 'none';
            document.getElementById('p2-sub-next').style.display   = name === 'next'   ? '' : 'none';
            window.scrollTo(0, 0);
        }

        function p2Back() {
            if (p2CurrentScreen === 0) {
                window.location.href = 'index.html';
            } else if (p2CurrentSubScreen === 'next') {
                showP2SubScreen('review');
            } else if (p2CurrentSubScreen === 'review') {
                showP2SubScreen('stages');
            } else {
                goToP2Screen(0);
            }
        }

        function p2Reset() {
            currentStage = '';
            currentFlippedCard = null;
            document.getElementById('cards-section').classList.remove('visible');
            document.querySelectorAll('.stage-circle').forEach(el => el.classList.remove('active'));
            document.querySelector('.stage-grid').classList.remove('compact');
            showP2SubScreen('stages');
            goToP2Screen(1);
        }

        // Override app.js: expand cards inline below stage grid
        function selectStage(stage) {
            currentStage = stage;
            const stageData = methodCards[stage];
            document.getElementById('cards-description').textContent = stageData.description;
            displayCards(stageData.cards);
            const colMap = { A: 1, B: 1, C: 3, D: 2, E: 2, F: 3, G: 4, H: 4 };
            const cardsEl = document.getElementById('cards-section');
            cardsEl.className = 'cards-section stage-theme-' + (colMap[stage] || 1);

            // Collapse grid to slim nav row BEFORE adding active, so the
            // compact transform:none rule is already in place and prevents any lift
            document.querySelector('.stage-grid').classList.add('compact');

            // Mark the clicked stage as active, clear others
            document.querySelectorAll('.stage-circle').forEach(el => el.classList.remove('active'));
            document.querySelector('[data-stage="' + stage + '"]').classList.add('active');

            // Expand inline (trigger CSS accordion)
            requestAnimationFrame(() => cardsEl.classList.add('visible'));
        }

        function goBackToStages() {
            currentStage = '';
            currentFlippedCard = null;
            document.getElementById('cards-section').classList.remove('visible');
            document.querySelectorAll('.stage-circle').forEach(el => el.classList.remove('active'));
            document.querySelector('.stage-grid').classList.remove('compact');
        }
    </script>
</body>
</html>
